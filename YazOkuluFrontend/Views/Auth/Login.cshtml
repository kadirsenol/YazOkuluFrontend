@model string
<div class="max-w-md mx-auto bg-white p-8 shadow rounded-lg mt-40">
    <h2 class="text-2xl font-semibold mb-6 text-center">Öğrenci Giriş (GSM)</h2>

    <form id="otpForm" class="space-y-4">
        <div>
            <label class="block text-gray-700 mb-1">Adınız</label>
            <input type="text" name="name" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required />

            <label class="block text-gray-700 mb-1 mt-2">GSM Numaranız</label>
            <input type="text" name="gsm" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" required />
        </div>

        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Kod Gönder</button>
    </form>
</div>

@section Scripts {
    <script>
        document.getElementById("otpForm").addEventListener("submit", async function(e) {
            e.preventDefault(); // sayfa yenilenmesini engelle

            const form = e.target;
            const data = {
                name: form.elements["name"].value.trim(),
                gsm: form.elements["gsm"].value.trim()
            };

            if (!data.name || !data.gsm) {
                showToast("Ad ve GSM boş olamaz.", "error");
                return;
            }

            localStorage.setItem("GSM", data.gsm);

            try {
                const response = await fetch("http://localhost:5273/api/auth/request-otp", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok && result.isSuccess !== false) {
                showToast(`OTP başarıyla oluşturuldu! ID: ${result.resultObject?.id || result.data?.id}`, "success");

           
                    setTimeout(() => window.location.href = "/Auth/VerifyOtp", 2000);
                } else {
                showToast(`Hata: ${result.message || "Bilinmeyen bir hata oluştu."}`, "error");

                }

            } catch (err) {
                console.error(err);
                showToast("Beklenmedik bir hata oluştu.", "error");

            }
        });
    </script>
}
