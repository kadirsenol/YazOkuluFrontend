@using YazOkuluFrontend.Enums
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Yaz Okulu</title>

    <script src="https://cdn.tailwindcss.com"></script>

  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />


    <script>
        const ROLE_ADMIN = @((int)RoleTypeEnum.admin);
    </script>

    <style>
        .logout-hidden {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-50 flex flex-col min-h-screen font-sans">

    
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-3">
                    <a asp-controller="Home" asp-action="Index" class="flex items-center">
                        <img class="h-10" src="https://halic.edu.tr/wp-content/uploads/2025/06/25/halic_universitesi_logo.svg" alt="Logo">
                        <span class="ml-2 text-xl font-bold text-gray-800 ">Yaz Okulu</span>
                    </a>
                </div>
                <nav class="space-x-4 hidden md:flex">
                    <a asp-controller="Courses" asp-action="Index" id="courseBtn" class="text-gray-700 hover:text-blue-600 transition-transform duration-300 hover:scale-105 d-flex align-items-center">
                        <i class="bi bi-book mr-1"></i> Dersler
                    </a>
                    <a asp-controller="Courses" asp-action="MyApplications" id="myApplicationBtn" class="text-gray-700 hover:text-blue-600 transition-transform duration-300 hover:scale-105 d-flex align-items-center">
                        <i class="bi bi-file-earmark-text mr-1"></i> Başvurularım
                    </a>
                    <a asp-controller="Admin" asp-action="Applications" id="applicationBtn" class="text-gray-700 hover:text-blue-600 transition-transform duration-300 hover:scale-105 d-flex align-items-center">
                        <i class="bi bi-people mr-1"></i> Başvurular
                    </a>
                    <a id="logoutBtn"
                       class="logout-hidden text-gray-700 hover:text-red-600 transition-transform duration-300 hover:scale-105 d-flex align-items-center"
                       href="#" onclick="logout()">
                        <i class="bi bi-box-arrow-right mr-1"></i> Çıkış
                    </a>

                </nav>

            </div>
        </div>
    </header>

    
    <main class="flex-grow container mx-auto px-4 py-6">
        @RenderBody()
    </main>

    
    <footer class="bg-white shadow-inner mt-8">
        <div class="max-w-7xl mx-auto px-4 py-6 text-center text-gray-500 text-sm">
            &copy; 2025 Haliç Üniversitesi - Yaz Okulu Ders Başvuru Modülü
        </div>
    </footer>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

    <script>
        
        function showToast(message, type = "success") {
            if (typeof toastr !== "undefined") {
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    positionClass: "toast-bottom-right",
                    timeOut: 3000
                };
                toastr[type](message); 
            } else {
                console.warn("Toastr yüklenmedi!");
                alert(message); 
            }
        }
    </script>

    @* logout *@
    <script>
        function logout() {
            
            localStorage.removeItem("Token");            
            document.cookie = "Token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC;";            
            showToast("Çıkış yapılıyor!", "success");            
            setTimeout(() => {
                window.location.href = "/";
            }, 500);
        }
    </script>


    @* token kontrolu *@
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const token = localStorage.getItem("Token");

            const logoutBtn = document.getElementById("logoutBtn");
            const courseBtn = document.getElementById("courseBtn");
            const myApplicationBtn = document.getElementById("myApplicationBtn");
            const addCourseBtn = document.getElementById("addCourseBtn");
            const applicationBtn = document.getElementById("applicationBtn");
            const studentLoginBtn = document.getElementById("studentLoginBtn");
            const adminLoginBtn = document.getElementById("adminLoginBtn");
            const editCourseBtn = document.getElementById("editCourseBtn");
            const deleteCourseBtn = document.getElementById("deleteCourseBtn");

            
            if (!token) {
                logoutBtn?.classList.add("logout-hidden");
                courseBtn?.classList.add("logout-hidden");
                myApplicationBtn?.classList.add("logout-hidden");
                applicationBtn?.classList.add("logout-hidden");
                studentLoginBtn?.classList.remove("logout-hidden");
                adminLoginBtn?.classList.remove("logout-hidden");
                addCourseBtn?.classList.add("logout-hidden");
                editCourseBtn?.classList.add("logout-hidden");
                deleteCourseBtn?.classList.add("logout-hidden");

            } else {
                logoutBtn?.classList.remove("logout-hidden");
                courseBtn?.classList.remove("logout-hidden");
                myApplicationBtn?.classList.remove("logout-hidden");
                studentLoginBtn?.classList.add("logout-hidden");
                adminLoginBtn?.classList.add("logout-hidden");

               
                let payload = null;
                try {
                    payload = JSON.parse(atob(token.split('.')[1]));
                } catch (e) {
                    console.warn("Token parse edilemedi:", e);
                }

                
                const userRole = payload ? payload["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"] : null;
                
                if (userRole === ROLE_ADMIN.toString()) {
                    applicationBtn?.classList.remove("logout-hidden");
                    addCourseBtn?.classList.remove("logout-hidden");
                    editCourseBtn?.classList.remove("logout-hidden");
                    deleteCourseBtn?.classList.remove("logout-hidden");
                } else {
                    applicationBtn?.classList.add("logout-hidden");
                    addCourseBtn?.classList.add("logout-hidden");
                    editCourseBtn?.classList.add("logout-hidden");
                    deleteCourseBtn?.classList.add("logout-hidden");
                }
            }
        });
    </script>

   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
